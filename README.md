# Test-Time Gym ç¯å¢ƒ

> ä¸€ä¸ªç”¨äº **LLM æ™ºèƒ½ä½“æµ‹è¯•æ—¶å­¦ä¹ ** çš„å®‰å…¨ä»¿çœŸç¯å¢ƒï¼Œæ”¯æŒå¤šæ­¥éª¤ä»»åŠ¡ï¼ˆå¦‚æœºç¥¨é¢„è®¢ï¼‰çš„æ¢ç´¢ã€ç»éªŒç§¯ç´¯ä¸ç¨‹åºåŒ–çŸ¥è¯†æŠ½å–ã€‚

---

## ğŸŒŸ ç‰¹ç‚¹

- **å®‰å…¨å¯æ§**ï¼šä¸æ¶‰åŠçœŸå®èµ„é‡‘æˆ–å¤–éƒ¨ APIï¼Œæ‰€æœ‰äº¤äº’å‡åœ¨æ¨¡æ‹Ÿç¯å¢ƒä¸­å®Œæˆã€‚
- **ç¨‹åºæ€§çŸ¥è¯†è·å–**ï¼šæ”¯æŒæ™ºèƒ½ä½“é€šè¿‡ç»éªŒæŒ–æ˜å½¢æˆå¯é‡ç”¨çš„ **æŠ€èƒ½ï¼ˆskills/macro-actionsï¼‰**ã€‚
- **åœ¨çº¿é€‚åº”**ï¼šå†…ç½®æ¢ç´¢/åˆ©ç”¨æœºåˆ¶ï¼ˆexplore vs exploitï¼‰ï¼Œè®©æ™ºèƒ½ä½“èƒ½åœ¨æµ‹è¯•æ—¶è‡ªæˆ‘æ”¹è¿›ã€‚
- **å¯å¤ç°**ï¼šæ”¯æŒéšæœºç§å­ä¸è½¨è¿¹å›æ”¾ï¼Œä¿è¯å®éªŒä¸€è‡´æ€§ã€‚
- **å¤šç»´è¯„ä¼°æŒ‡æ ‡**ï¼šä»»åŠ¡æˆåŠŸç‡ã€çº¦æŸè¿è§„ç‡ã€å¹³å‡æ­¥é•¿ã€åæ‚”å€¼ï¼ˆRegretï¼‰ç­‰ã€‚

---

## ğŸ— ç³»ç»Ÿæ¶æ„

```mermaid
flowchart TD
    A[LLM Agent] -->|åŠ¨ä½œè°ƒç”¨| B[Test-Time Gym ç¯å¢ƒ]
    B -->|çŠ¶æ€/å¥–åŠ±| A
    B --> C[æ—¥å¿—ä¸è¯„ä¼°æ¨¡å—]
    C --> A
```

**æ¨¡å—è¯´æ˜ï¼š**

- **LLM Agent**ï¼šç­–ç•¥é€‰æ‹©ã€æŠ€èƒ½è°ƒç”¨ã€ç»éªŒæ›´æ–°
- **Gym ç¯å¢ƒ**ï¼šçŠ¶æ€ç”Ÿæˆã€åŠ¨ä½œæ‰§è¡Œã€å¥–åŠ±è®¡ç®—ã€éšæœºæ‰°åŠ¨
- **æ—¥å¿—/è¯„ä¼°**ï¼šä»»åŠ¡æˆåŠŸç‡ã€æ­¥é•¿ã€æ¢ç´¢/åˆ©ç”¨æ¯”ä¾‹ç­‰

---

## ğŸ® ç¯å¢ƒè®¾è®¡

### çŠ¶æ€ï¼ˆObservationï¼‰

```json
{
  "view": "search_results | cart | payment | receipt | error",
  "forms": {"from": "SFO", "to": "MAD", "date": "2025-10-15"},
  "flights": [
    {"id": "IB6123", "price": 870, "depart": "10:40", "arrive": "07:15+1", "stops": 1, "airline": "IB"}
  ],
  "cart": {"items": [{"flight_id": "IB6123", "price": 870}], "total": 870},
  "payment_state": {"needs_3ds": true, "attempts": 0},
  "constraints": {"budget": 900, "depart_after": "10:00", "max_stops": 1},
  "messages": ["Tip: Prices drop if you shift Â±1 day"]
}
```

### åŠ¨ä½œï¼ˆActionï¼‰

- `search_flights(from, to, date)`
- `filter_results({depart_after, max_stops, airline})`
- `select_flight(flight_id)`
- `add_to_cart(flight_id)`
- `proceed_to_payment()`
- `enter_card(card_token)`
- `confirm_payment()`
- `apply_coupon(code)`
- `restart()` / `abort()`

### å¥–åŠ±æœºåˆ¶ï¼ˆRewardï¼‰

| å¥–åŠ±ç±»å‹        | æè¿°                          | åˆ†å€¼èŒƒå›´ |
|-----------------|-------------------------------|----------|
| ç»ˆå±€å¥–åŠ±        | æˆåŠŸå‡ºç¥¨ä¸”æ»¡è¶³çº¦æŸ            | +1.0     |
| çº¦æŸè¿è§„        | è¶…é¢„ç®—ã€æ—¶é—´ä¸ç¬¦ç­‰            | -0.3     |
| è¿‡ç¨‹å¥–åŠ±        | è´­ç‰©è½¦éç©ºã€è¿›å…¥æ”¯ä»˜é¡µç­‰      | +0.02~0.05 |
| æƒ©ç½š            | æ— æ•ˆåŠ¨ä½œã€æ”¯ä»˜å¤±è´¥            | -0.05    |
| æ—¶é—´æˆæœ¬        | æ¯æ­¥æ¶ˆè€—                      | -0.01    |

### éšæœºæ‰°åŠ¨

- éšæœºè¦æ±‚ **3DS éªŒè¯**
- éšæœº **æ”¯ä»˜å¤±è´¥**
- éšæœº **èˆªç­å”®ç½„**
- èˆªç­æ’åºéšæœºåŒ–

---

## ğŸ§  æ™ºèƒ½ä½“å­¦ä¹ æœºåˆ¶

1. **æŠ€èƒ½æå–**ï¼šä»æˆåŠŸè½¨è¿¹ä¸­æŒ–æ˜é«˜é¢‘å­æµç¨‹ï¼Œç”Ÿæˆå¯å¤ç”¨çš„ `macro-skill`ã€‚
2. **ç­–ç•¥é€‰æ‹©**ï¼šä½¿ç”¨ **Thompson Sampling / Contextual Bandit** åœ¨æŠ€èƒ½é›†åˆä¸­é€‰æ‹©ã€‚
3. **å†…åœ¨å¥–åŠ±**ï¼šé€šè¿‡è¿›å±•åº¦é‡ã€è‡ªæ´½æ€§æ£€æŸ¥ã€é¢„æµ‹è¯¯å·®æä¾›æ¢ç´¢ä¿¡å·ã€‚
4. **è®°å¿†æ›´æ–°**ï¼šè’¸é¦æˆåŠŸç‡é«˜çš„æŠ€èƒ½ï¼Œè¡°å‡æ·˜æ±°ä½æ•ˆæŠ€èƒ½ã€‚

---

## ğŸ“Š è¯„ä¼°æŒ‡æ ‡

- **ä»»åŠ¡æˆåŠŸç‡**ï¼šæˆåŠŸå‡ºç¥¨ä¸”æ»¡è¶³çº¦æŸçš„æ¯”ä¾‹
- **å¹³å‡æ­¥é•¿**ï¼šå®Œæˆä»»åŠ¡çš„å¹³å‡æ“ä½œæ•°
- **çº¦æŸè¿è§„ç‡**ï¼šæœªæ»¡è¶³é¢„ç®—/æ—¶é—´è¦æ±‚çš„æ¯”ä¾‹
- **æ¢ç´¢/åˆ©ç”¨æ¯”**ï¼šæŠ€èƒ½è°ƒç”¨ vs æ–°æ¢ç´¢çš„æ¯”ä¾‹
- **åæ‚”å€¼ï¼ˆRegretï¼‰**ï¼šå®é™…ç¥¨ä»· âˆ’ æœ€ä¼˜ç¥¨ä»·

---

## ğŸš€ ç¤ºä¾‹è¿è¡Œæµç¨‹

1. Agent æ¥æ”¶ä»»åŠ¡ï¼šSFOâ†’MADï¼Œé¢„ç®— â‰¤900
2. `search_flights()` â†’ å¾—åˆ°ç»“æœ
3. `filter_results({"depart_after":"10:00"})` â†’ ç­›é€‰
4. `add_to_cart(flight_id)` â†’ åŠ å…¥è´­ç‰©è½¦
5. `proceed_to_payment()` â†’ è¿›å…¥æ”¯ä»˜é¡µé¢
6. `enter_card()` + `confirm_payment()` â†’ å‡ºç¥¨æˆåŠŸ
7. å¥–åŠ± +1.0ï¼Œè½¨è¿¹è¢«å­˜å‚¨ä¸ºç»éªŒ
8. åç»­ä»»åŠ¡ä¸­ç›´æ¥è°ƒç”¨è¯¥æŠ€èƒ½ï¼Œå‡å°‘æ¢ç´¢

---

## ğŸ›  å¿«é€Ÿå¼€å§‹

```bash
git clone https://github.com/your-org/test-time-gym.git
cd test-time-gym
pip install -e .
```

è¿è¡Œä¸€ä¸ª **dummy agent**ï¼š

```python
from test_time_gym.envs.flight_booking_env import FlightBookingEnv

env = FlightBookingEnv(seed=42)
obs, info = env.reset()

done, trunc, total_r = False, False, 0.0
while not (done or trunc):
    action = {"verb": 0, "payload": ""}  # ç¤ºä¾‹åŠ¨ä½œï¼šsearch_flights
    obs, reward, done, trunc, info = env.step(action)
    total_r += reward

print("Total Reward:", total_r)
```

---

## ğŸ“‚ ç›®å½•ç»“æ„

```
test-time-gym/
â”‚â”€â”€ envs/
â”‚   â””â”€â”€ flight_booking_env.py   # ç¯å¢ƒå®ç°
â”‚â”€â”€ agents/
â”‚   â””â”€â”€ dummy_agent.py          # ç¤ºä¾‹ agent
â”‚â”€â”€ logs/                       # è¿è¡Œæ—¥å¿—ä¸è½¨è¿¹
â”‚â”€â”€ README.md                   # é¡¹ç›®æ–‡æ¡£
```

---

## ğŸ“Œ æœªæ¥æ‰©å±•

- å¢åŠ  **å¤šä»»åŠ¡åœºæ™¯**ï¼ˆé…’åº—é¢„è®¢ã€è´­ç‰©ç»“è´¦ã€è¡¨å•å¡«å†™ï¼‰
- å¼•å…¥ **æ›´å¤æ‚çš„æ”¯ä»˜æµç¨‹**ï¼ˆåˆ†æœŸã€é€€æ¬¾ã€å–æ¶ˆï¼‰
- æ”¯æŒ **å¤šæ™ºèƒ½ä½“äº¤äº’**ï¼ˆç«äº‰/åä½œè®¢ç¥¨ï¼‰
- é›†æˆ **å¯è§†åŒ–å·¥å…·**ï¼Œå±•ç¤ºè½¨è¿¹ä¸æŠ€èƒ½æ¼”åŒ–è¿‡ç¨‹
